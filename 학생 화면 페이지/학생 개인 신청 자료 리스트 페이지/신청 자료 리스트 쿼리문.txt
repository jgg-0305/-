--- 데이터 조회 ---
-- 사용자 기본 정보 조회 (헤더 또는 정보 박스)
SELECT
    usr_name,
    usr_enrl,
    usr_stat
FROM
    users
WHERE
    usr_id = '로그인한_사용자_ID';

-- 희망 자료 신청 목록 조회 및 필터링
SELECT
    T1.req_id AS No,
    T1.req_title AS 서명,
    T1.req_auth AS 저자,
    T1.req_date AS 신청일,
    T1.req_stat AS 처리상태,  
FROM
    requests T1
WHERE
    T1.usr_id = '로그인한_사용자_ID' -- 사용자 ID 필터링
    -- [선택적 검색 조건]
    AND T1.req_title LIKE '%검색어%' -- 서명 검색 필터
ORDER BY
    T1.req_date DESC; -- 최신 신청일 순으로 정렬

-- 신청 총 건수 조회
SELECT
    COUNT(*) AS total_count
FROM
    requests
WHERE
    usr_id = '로그인한_사용자_ID';

--- 데이터 업데이트 ---
-- 희망 자료 신청 취소(신청 상태가 '접수대기'와 같이 취소 가능한 상태일 때만 허용)
UPDATE
    requests
SET
    req_stat = '신청취소',
    req_note = CONCAT(IFNULL(req_note, ''), ' / ', '사용자 취소:', NOW())
WHERE
    req_id = '취소할_신청_ID'
    AND usr_id = '로그인한_사용자_ID' -- 본인의 신청인지 다시 확인 (보안)
    AND req_stat = '접수대기'; -- 예시: 접수대기 상태에서만 취소 가능

--- 인덱스 생성 ---
-- 사용자 ID별 신청 내역 조회를 위한 인덱스
CREATE INDEX idx_requests_usr_id
ON requests (usr_id);

-- 사용자 ID와 신청 상태를 결합한 복합 인덱스
CREATE INDEX idx_requests_user_stat
ON requests (usr_id, req_stat);

-- 신청일 역순 정렬을 빠르게 하기 위한 인덱스
CREATE INDEX idx_requests_date_desc
ON requests (req_date DESC);
